@using HydroToolChain.App.Configuration.Data

<MatDialogTitle Class="edit-project-dialog__title">Edit: @Project.Name</MatDialogTitle>
<MatDialogContent>
    <EditForm Model="Project" OnSubmit="OnSubmit">
        <DataAnnotationsValidator/>
        <div class="edit-project-dialog__form flex column">
            <div class="flex row">
                <div class="flex column">
                    <MatTextField Label="Name" @bind-Value="Project.Name" HelperText="Ex: HMLoader"></MatTextField>
                    <ValidationMessage class="validator" For="@(() => Project.Name)"/>
                </div>

                <MatTooltip Tooltip="Used for ordering when using legacy loading, leave 500 if mod is in steam workshop" Context="ctx">
                    <div class="flex column">
                        <MatTextField TValue="int" RefBack="@ctx" Icon="info" Label="Index" @bind-Value="Project.ModIndex" ValidationDisabled="true"></MatTextField>
                    </div>
                </MatTooltip>
            </div>
            
            <div class="flex column">
                <MatTextField Label="Assets Path" @bind-Value="Project.CookedAssetsPath" HelperText="Ex: C:\contoso\Mining\Saved\Cooked\WindowsNoEditor\Mining"></MatTextField>
                <ValidationMessage class="validator" For="@(() => Project.CookedAssetsPath)"/>
            </div>
            <div class="flex column">
                <MatTextField Label="Dist Path" @bind-Value="Project.OutputPath" HelperText="Ex: C:\contoso\ModDist"></MatTextField>
                <ValidationMessage class="validator" For="@(() => Project.OutputPath)"/>
            </div>
        </div>

        <MatDialogActions Class="edit-project-dialog__actions">
            <MatButton Class="edit-project-dialog__actions__button" Type="submit">Save</MatButton>
            <MatButton Class="edit-project-dialog__actions__button" OnClick="() => CloseDialog()">Cancel</MatButton>
        </MatDialogActions>
    </EditForm>
</MatDialogContent>

@code {
    [CascadingParameter]
    public MatDialogReference DialogReference { get; set; }  = null!;
    
    [Parameter]
    public ProjectData Project { get; set; }  = null!;

    private void CloseDialog(bool sendResult = false)
    {

        var result = sendResult ? Project : null;
        
        DialogReference.Close(result);
    }

    private void OnSubmit(EditContext ctx )
    {
        if (!ctx.Validate())
        {
            return;
        }
        
        CloseDialog(true);
    }
}